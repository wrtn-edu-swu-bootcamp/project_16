// This is your Prisma schema file for TweetLingo
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// User model
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts      Account[]
  sessions      Session[]
  words         Word[]
  tweets        Tweet[]
  notionIntegration NotionIntegration?
  settings      UserSettings?

  @@map("users")
}

// Auth.js models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// Tweet model
model Tweet {
  id        String   @id @default(cuid())
  tweetId   String   @unique
  url       String
  text      String   @db.Text
  author    String?
  language  Language
  analyzedAt DateTime @default(now())
  userId    String
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  words     Word[]

  @@index([userId])
  @@index([tweetId])
  @@map("tweets")
}

// Word model
model Word {
  id            String       @id @default(cuid())
  lemma         String
  original      String
  language      Language
  partOfSpeech  PartOfSpeech
  translation   String
  definition    String?
  ipaNotation   String?
  hangulNotation String?
  example       String       @db.Text
  status        WordStatus   @default(LEARNING)
  savedAt       DateTime     @default(now())
  reviewDate    DateTime?
  userId        String
  tweetId       String?
  
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  tweet         Tweet?       @relation(fields: [tweetId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([language])
  @@index([status])
  @@index([savedAt])
  @@index([userId, status])
  @@index([userId, language])
  @@map("words")
}

// Notion integration
model NotionIntegration {
  id                 String   @id @default(cuid())
  userId             String   @unique
  accessToken        String   @db.Text
  workspaceId        String?
  workspaceName      String?
  databaseId         String?
  databaseName       String?
  isActive           Boolean  @default(true)
  autoSync           Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  lastSyncAt         DateTime?

  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notion_integrations")
}

// User settings
model UserSettings {
  id                    String   @id @default(cuid())
  userId                String   @unique
  targetLanguage        Language @default(KO)
  defaultSourceLanguage Language @default(EN)
  notificationsEnabled  Boolean  @default(true)
  reviewReminderTime    String?
  theme                 Theme    @default(LIGHT)
  
  // Auto-save settings (Phase 2)
  autoSaveWords         Boolean  @default(false)
  autoSaveLanguages     Language[] @default([EN, JA, ZH])
  autoSaveMinWords      Int      @default(3)
  
  // Chrome Extension integration
  extensionConnected    Boolean  @default(false)
  extensionLastUsed     DateTime?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_settings")
}

// Enum types
enum Language {
  EN
  JA
  ZH
  KO
}

enum PartOfSpeech {
  NOUN
  VERB
  ADJECTIVE
  ADVERB
}

enum WordStatus {
  LEARNING
  REVIEW
  MASTERED
}

enum Theme {
  LIGHT
  DARK
  SYSTEM
}
